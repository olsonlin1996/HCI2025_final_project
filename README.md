# 手勢控制介面

一個使用 Python 和 OpenCV 建立的即時手勢辨識系統。此介面允許使用者透過在可自訂的螢幕區域上移動手部來觸發指令。

## 功能特色

- **即時手部偵測**：使用 MediaPipe 框架精確追蹤手部關鍵點（以中指根部關節為主要判斷點），提供更準確的互動體驗。
- **互動式使用者介面**：直接在攝影機畫面中顯示指令區域和視覺回饋。
- **動態佈局編輯**：按下 'e' 鍵進入拖放介面，即時移動和重新定位指令框。
- **多攝影機支援**：自動偵測可用的攝影機並允許使用者選擇要使用的攝影機。
- **照片儲存**：一個「拍照」指令，將當前畫面以時間戳記儲存到本地 `photos/` 目錄。
- **使用者友善的校準**：一個簡單的、透過按鍵啟動的過程，用於校準背景以實現準確的運動偵測。

## 系統要求

- Python 3.x
- 網路攝影機
- `requirements.txt` 中列出的套件

## 繁體中文顯示的字體要求

本應用程式使用繁體中文字元作為其使用者介面。為確保正確顯示，系統會依序嘗試從以下路徑載入字體檔案：

1.  `C:/Windows/Fonts/msjh.ttf` (微軟正黑體)
2.  `C:/Windows/Fonts/mingliu.ttc` (細明體)
3.  `msjh.ttf` (來自專案目錄)

如果這些字體都找不到，應用程式將會回退到預設系統字體，這可能無法正確顯示繁體中文字元。

**字體問題疑難排解：**
-   **字體缺失**：如果繁體中文字元顯示不正確，請確保您的 `C:/Windows/Fonts` 目錄中安裝了 `msjh.ttf` 或 `mingliu.ttc`。這些是標準的 Windows 字體。
-   **自訂字體**：您可以將相容的 `.ttf` 或 `.ttc` 字體檔案直接放置在專案的根目錄中，並將其命名為 `msjh.ttf`，以便應用程式使用。

## 設定與安裝

1.  **複製儲存庫 (或下載檔案)。**

2.  **安裝所需的 Python 套件：**
    在專案目錄中開啟終端機或命令提示字元並執行：
    ```bash
    pip install -r requirements.txt
    ```

## 如何使用

1.  **執行主程式：**
    ```bash
    python main.py
    ```

2.  **初始選單：**
    - 將會出現一個視窗，顯示您的網路攝影機畫面和選單。
    - **按下 's'**：直接進入手勢偵測模式。
    - **按下 'e'**：進入 **編輯模式**。
    - **按下 'q'**：退出程式。

3.  **編輯模式 (可選)：**
    - 如果您按下 'e'，現在可以自訂佈局。
    - **拖放**：使用滑鼠點擊並拖曳指令框到您想要的位置。
    - **按下 's'**：儲存新佈局並返回初始選單。

4.  **互動：**
    - 進入手勢偵測模式後，將手移到指令框上方以開始啟動它。
    - 進度條將會填滿。保持手部穩定直到填滿，以觸發指令。
    - **拍照**：如果觸發，當前圖像將儲存到 `photos/` 資料夾中。

5.  **退出程式：**
    - 您可以在主偵測迴圈中的任何時候，透過手勢觸發「退出」指令或按下 **'q'** 鍵來退出程式。

## 檔案結構

- `main.py`：主應用程式腳本。
- `edit_layout.py`：包含互動式佈局編輯器功能的模組。
- `requirements.txt`：Python 依賴套件列表。
- `photos/`：將用於儲存照片的目錄。

## 擴增功能

您可以透過修改 `main.py` 檔案來輕鬆新增自己的指令區塊與功能。請依照以下步驟操作：

> **重要提示**：目前指令的觸發是基於 MediaPipe 偵測到的手部關鍵點（預設為**中指根部關節**）是否進入指令區塊。因此，新增功能時請考慮這種互動方式。

### 步驟 1：新增指令區塊定義

首先，在 `main.py` 檔案頂部的 `COMMAND_ZONES` 列表中新增一個新的指令區塊。每個區塊都是一個包含五個值的元組 (tuple)：

`(x座標, y座標, 寬度, 高度, "指令名稱")`

例如，若要新增一個名為「顯示文字 (Show Text)」的區塊，您可以如下修改 `COMMAND_ZONES`：

```python
# --- 參數設定 ---
# ... (其他參數)
COMMAND_ZONES = [
    (50, 50, 200, 100, "拍照 (Take Photo)"),
    (1030, 570, 200, 100, "播放影片 (Play Video)"),
    (50, 570, 200, 100, "結束程式 (Exit)"),
    (540, 50, 200, 100, "顯示文字 (Show Text)")  # <-- 新增的指令區塊
]
# ...
```
> **提示**：您可以先執行程式並進入編輯模式 (`e`鍵)，將現有區塊拖到您想要的位置，然後記下其座標，以幫助您決定新區塊的初始位置。

### 步驟 2：實作區塊對應的功能

接下來，在 `main.py` 的主偵測迴圈中，找到判斷指令名稱的 `if/elif` 結構，並為您的新指令新增一個 `elif` 區塊。

在 `while True:` 迴圈中找到以下程式碼區塊：

```python
# ...
if zone_accumulators[i] > TRIGGER_THRESHOLD:
    print(f"指令觸發: {name}")

    if name == "拍照 (Take Photo)":
        # ... (拍照的程式碼)

    elif name == "播放影片 (Play Video)":
        # ... (播放影片的程式碼)

    # 在這裡新增您的程式碼
    elif name == "顯示文字 (Show Text)":
        print("這是一個新的自訂功能！")
        # 在這裡撰寫您想要執行的任何 Python 程式碼
        # 例如：在畫面上顯示一段文字幾秒鐘
        cv2.putText(frame, "Hello, Custom Function!", (400, 360), 
                    cv2.FONT_HERSHEY_SIMPLEX, 1.5, (0, 255, 0), 3)
        cv2.imshow("Hand Gesture Interface", frame)
        cv2.waitKey(2000) # 顯示文字 2 秒

    if name == "結束程式 (Exit)":
        # ... (結束程式的程式碼)
    
    zone_accumulators[i] = 0
# ...
```

完成以上兩個步驟後，重新執行 `python main.py`，您就會在畫面上看到新的指令區塊，並且可以透過手勢觸發您自訂的新功能。

## 最近更新

- **移除校準步驟與提升偵測精準度**：由於引入 MediaPipe，移除了不必要的校準步驟，並透過調整手部關鍵點判斷，顯著提升了指令觸發的精準度。
- **手部偵測功能**：引入 MediaPipe 實現更精確的手部偵測，取代原有的背景減除法。
- **視覺回饋**：觸發指令區塊後，會顯示 5 秒的半透明綠色視覺回饋，提供更直觀的操作確認。
- **`main.py`**：主應用程式邏輯的通用更新和改進。
- **`requirements.txt`**：依賴套件已更新。
- **新媒體**：新增了圖像檔案到 `photos/` 和一個影片檔案 `高清版瑞克搖.mp4`。